<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A-to-Z tutorial - example analysis &mdash; RNAlysis 3.2.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="User guide" href="user_guide.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About RNAlysis:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">What is <em>RNAlysis?</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#what-can-i-do-with-rnalysis">What can I do with <em>RNAlysis</em>?</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#how-do-i-install-it">How do I install it?</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#how-do-i-use-it">How do I use it?</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#dependencies">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html#credits">Credits</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/GuyTeichman/RNAlysis">GitHub page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Starting with RNAlysis:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">A-to-Z tutorial - example analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro-and-recommendations">Intro and recommendations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analysis-1-time-series-rna-sequencing">Analysis #1 - time series RNA sequencing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-dataset">The dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-preprocessing-and-exploratory-data-analysis">Data preprocessing and exploratory data analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#filter-out-lowly-expressed-genes">Filter out lowly-expressed genes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examine-variance-in-our-data-with-principal-component-analysis">Examine variance in our data with Principal Component Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examine-similarity-between-developmental-stages">Examine similarity between developmental stages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compare-the-expression-of-specific-genes-over-the-developmental-stages">Compare the expression of specific genes over the developmental stages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#clustering-analysis">Clustering analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-simple-approach-distance-based-clustering-with-k-medoids">The simple approach - distance-based clustering with K-Medoids</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fine-tuning-our-approach-density-based-clustering-with-hdbscan">Fine-tuning our approach - density-based clustering with HDBSCAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-complex-approach-ensemble-based-clustering-with-clicom">The complex approach - ensemble-based clustering with CLICOM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#enrichment-analysis">Enrichment analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-enrichment-analysis">Running enrichment analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analysis-2-differential-expression-data">Analysis #2 - differential expression data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">The dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-filtering-and-visualization-with-pipelines">Data filtering and visualization with Pipelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#apply-the-pipeline-to-our-datasets">Apply the Pipeline to our datasets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-and-extracting-gene-set-interesctions">Visualizing and extracting gene set interesctions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-a-venn-diagram">Create a Venn diagram</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extract-the-subsets-we-are-interested-in">Extract the subsets we are interested in</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Enrichment analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-a-background-set">Define a background set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-our-custom-enrichment-attributes">Define our custom enrichment attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">Running enrichment analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Change history:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rnalysis.filtering.html">rnalysis.filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="rnalysis.enrichment.html">rnalysis.enrichment</a></li>
<li class="toctree-l1"><a class="reference internal" href="rnalysis.general.html">rnalysis.general</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Indices and tables:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RNAlysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>A-to-Z tutorial - example analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a-to-z-tutorial-example-analysis">
<h1>A-to-Z tutorial - example analysis<a class="headerlink" href="#a-to-z-tutorial-example-analysis" title="Permalink to this heading"></a></h1>
<section id="intro-and-recommendations">
<h2>Intro and recommendations<a class="headerlink" href="#intro-and-recommendations" title="Permalink to this heading"></a></h2>
<p>In this A-to-Z tutorial, we are going to analyze two datasets step-by-step, with each analysis covering different aspects of using <em>RNAlysis</em>.</p>
<p>These analyses both focus on RNA sequencing data from nematodes, but the same principles can be applied to data from any organism.</p>
</section>
<section id="analysis-1-time-series-rna-sequencing">
<h2>Analysis #1 - time series RNA sequencing<a class="headerlink" href="#analysis-1-time-series-rna-sequencing" title="Permalink to this heading"></a></h2>
<section id="the-dataset">
<h3>The dataset<a class="headerlink" href="#the-dataset" title="Permalink to this heading"></a></h3>
<p>For the first analysis, we will use a publicly available dataset from <a class="reference external" href="https://downloads.wormbase.org/species/c_elegans/annotation/RNASeq_controls_FPKM/c_elegans.PRJNA13758.current.RNASeq_controls_FPKM.dat">WormBase</a>. This dataset describes the mean expression level of each gene over the developmental stages of <em>C. elegans</em> nematodes, averaged from RNA-sequencing short-read experiments that have been identified in the literature as being ‘controls’.</p>
<p>The original table linked above contains the mean expression, median expression, and number of samples for each developmental stage. Since we are only interested in the means, before starting the analysis, I copied the Mean columns to a new table, and gave the columns more readable names.
You can find the table I created <a class="reference external" href="https://raw.githubusercontent.com/GuyTeichman/RNAlysis/master/tests/test_files/elegans_developmental_stages.tsv">here</a>.</p>
<p>Let’s start by loading the dataset - in the main window, click on the “Load” button and choose the table’s file from your computer.
We will then use the drop-down menu to change our table type from “Other” to “Count matrix”. This will allow us to later on use analysis methods that are applicable only to count matrix-style datasets.
.. image:: /tutorial_screenshots/01a01_load_table.png</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">width</dt>
<dd class="field-odd"><p>600</p>
</dd>
<dt class="field-even">alt</dt>
<dd class="field-even"><p>Loading a table into <em>RNAlysis</em> - choose the table type</p>
</dd>
</dl>
</div></blockquote>
<p>Once we picked a table type, a new option will appear, allowing us to specify whether our table was pre-normalized. We will set this option to “True”, since our dataset was already normalized to Fragments Per Kilobase Million (FPKM).
This is not a mandatory step, but if we don’t do it, <em>RNAlysis</em> will warn us whenever we run analyses that expect normalized values.</p>
<a class="reference internal image-reference" href="_images/01a02_load_table.png"><img alt="Loading a table into *RNAlysis* - set the table as pre-normalized" src="_images/01a02_load_table.png" style="width: 600px;" /></a>
<p>Finally, we can click the “start” button to finish loading our dataset into <em>RNAlysis</em>.
The window will now display a preview of our table, as well as a a short summary of our table’s content (table name, table type, number of rows and columns).</p>
<a class="reference internal image-reference" href="_images/01b01_view_table.png"><img alt="Preview the loaded table" src="_images/01b01_view_table.png" style="width: 600px;" /></a>
<p>If we want to see the entire table, we can click on the “View full table” button, and the entire table will appear in a new window:</p>
<a class="reference internal image-reference" href="_images/01b02_view_table.png"><img alt="View the table" src="_images/01b02_view_table.png" style="width: 600px;" /></a>
<p>At any point during the analysis, we can click the “Save table” button to save our table into a new file.</p>
</section>
<section id="data-preprocessing-and-exploratory-data-analysis">
<h3>Data preprocessing and exploratory data analysis<a class="headerlink" href="#data-preprocessing-and-exploratory-data-analysis" title="Permalink to this heading"></a></h3>
<p>We can now begin exploring our data! Let’s start with a pre-processing step - removing lowly-expressed genes.</p>
<section id="filter-out-lowly-expressed-genes">
<h4>Filter out lowly-expressed genes<a class="headerlink" href="#filter-out-lowly-expressed-genes" title="Permalink to this heading"></a></h4>
<p>We want to filter out the genes that have not been expressed or that have low expression across all samples.
Lowly-expressed genes can negatively affect our analysis downstream, since the % error in the expression of these genes is relatively high, and these genes are likely to add noise rather than useful signal to our analysis.
We are going to filter our table, so that we keep only genes with 50 or more normalized reads in at least 1 experimental condition.</p>
<p>To apply a filtering function to our table, click on the “Filter” tab, and select a function from the drop-down menu that opens:</p>
<a class="reference internal image-reference" href="_images/01c01_filter_low_reads.png"><img alt="Choose a filtering function" src="_images/01c01_filter_low_reads.png" style="width: 600px;" /></a>
<p>We are going to select “Filter genes with low expression in all columns”. This function will filter our any gene whose expression level is lower than X in every single column. This means we only keep genes that are reasonably expressed in at least one experimental condition.
If you are not sure what a function does, you can click on the blue question mark button next to the function’s name to read a short description, or go to the function’s help page by clicking on the blue link at the bottom of the main window.</p>
<p>Once we choose a function, the window will expand, and the filtering function’s parameters will be displayed below. We can modify these parameters to choose exactly how to filter our table.</p>
<p>In this example, we are going to set the parameter <cite>threshold</cite> to 50 FPKM. This means that any genes which have less than 50 FPKM in <strong>all</strong> of the table’s columns will be filtered out.
If you are not sure what a parameter does, you can hover your cursor over its name, or click on the blue question mark button next to the parameter’s name.</p>
<p>Every filtering function in <em>RNAlysis</em> supports two additional parameters: <cite>opposite</cite> and <cite>inplace</cite>.</p>
<p><cite>opposite</cite>, as the name indicates, allows you to apply the <strong>inverse</strong> of your filtering operation to your table. For example, in our case, instead of filtering out lowly-expressed genes, we will filter out everything <strong>but</strong> the lowly-expressed genes.</p>
<p><cite>inplace</cite> allows us to choose whether we want to apply the filtering operation in the same window (default), or to keep an unfiltered version of the table and apply the filtering operation in a new tab.
This can be conveniet if we want to try multiple filtering approaches in parallel, or if we need to use the unfiltered table later down the line.
Regardless of what we choose, the original file we loaded will not be changed by our filtering unless we expelicitly save our filtering results, and any filtering operation we apply can be undone with the click of a button.</p>
<p>Once we are happy with the parameters we chose, we can scroll down and click on the “Apply” button to apply the filtering function to our table.</p>
<a class="reference internal image-reference" href="_images/01c02_filter_low_reads.png"><img alt="Set filtering parameters" src="_images/01c02_filter_low_reads.png" style="width: 600px;" /></a>
<p>After clicking “Apply”, we can see that our action has been added to the <em>command history</em> pane on the right of the window. We can undo and redo any operation we apply inplace by clicking on a specific row in this pane.
Moreover, we can see that a short summary of our filtering action has printed to the log box at the bottom, and that the name and size of the table have been updated.</p>
<a class="reference internal image-reference" href="_images/01c03_filter_low_reads.png"><img alt="Filtering results" src="_images/01c03_filter_low_reads.png" style="width: 600px;" /></a>
</section>
<section id="examine-variance-in-our-data-with-principal-component-analysis">
<h4>Examine variance in our data with Principal Component Analysis<a class="headerlink" href="#examine-variance-in-our-data-with-principal-component-analysis" title="Permalink to this heading"></a></h4>
<p>The first analysis we will perform is Principal Component Analysis, or PCA.
Principal component analysis is a dimensionality-reduction method. Meaning, it can reduce the dimensionality of large data sets (e.g. the expression of thousands of genes), by transforming the expression data of these genes into a smaller dataset that still contains most of the information from the original dataset.</p>
<p>Since our dataset contains thousands of genes, it can be difficult to see how the different conditions differ in the expression of those genes. To remedy that, PCA analysis can “rearrange” the axes of our data such that we can summarize most of the variance of our dataset in very few dimensions (~2-10 dimensions).</p>
<p>You can read more about PCA <a class="reference external" href="https://builtin.com/data-science/step-step-explanation-principal-component-analysis">here</a>.</p>
<p>To run a PCA, click on the “Visualize” tab, and select “Principal Component Analysis” from the drop-down menu.</p>
<a class="reference internal image-reference" href="_images/01d01_pca.png"><img alt="Choose a visualization function function" src="_images/01d01_pca.png" style="width: 600px;" /></a>
<p>The ‘samples’ parameter allows you to choose which samples will be analyzed with PCA, and also lets you group these samples into sub-groups (for example, group replicate data by experimental condition), so that each sub-group will be drawn with a different color on the final graph.
In our case we only have one column per condition, and we want to examine them all, so we don’t need to change this parameter.</p>
<p>By default, <em>RNAlysis</em> will apply a power-transform (Box-Cox) to the data before standardazing it and running PCA. This is the case for many functions in <em>RNAlysis</em>, since applying power transform minimizes undesirable characteristics of counts data, such as skeweness, mean-variance dependence, and extreme values.
However, this feature can always be disabled with the <cite>power_transform</cite> parameter.</p>
<p>Let’s apply the analysis and look at the output:</p>
<a class="reference internal image-reference" href="_images/01d02_pca.png"><img alt="Principal Component Analysis" src="_images/01d02_pca.png" style="width: 600px;" /></a>
<p><em>RNAlysis</em> generated three graphs, depicting all of the pair-wise combinations between Principal Components #1-3.
We can visualize less or more principal components by changing the value of the <cite>n_components</cite> parameter.</p>
<p>Usually the most relevant graph is the one depicting the first and second PCs, since they explain the largest amount of variance in the data.</p>
<p>In our case, we can see that PCs 1-2 together explain ~75% of the variance in our dataset. Interestingly, the PCA shows a semi-circular pattern, ordered by the developmental stage of the worms.
My hypothesis would be that PC1 arranges the samples by their relative “germline” content - embryos are mostly gonads, adult nematodes contain a rather large quantity of germ cells, L4 larvae is the developmental stage where germline proliferation begins, and during the L1-L3 stages the relative germline content of the worms is relatively minimal.
PC2 appears to arrange the samples by their developmental stage, with embryos appearing at the top of the graph and adults at the bottom.</p>
</section>
<section id="examine-similarity-between-developmental-stages">
<h4>Examine similarity between developmental stages<a class="headerlink" href="#examine-similarity-between-developmental-stages" title="Permalink to this heading"></a></h4>
<p>Let’s now examine the distribution of gene expression across developmental stages with a <a href="#id7"><span class="problematic" id="id8">`Pair-plot&lt;https://pythonbasics.org/seaborn-pairplot/&gt;`_</span></a>.
Pair-plots displays the pairwise relationships between samples, or experimental conditions, in our dataset, and also display a histogram of gene expression values within each sample/condition.</p>
<p>#TODO: stopped here</p>
<a class="reference internal image-reference" href="_images/01e02_pairplot.png"><img alt="Pair-plot" src="_images/01e02_pairplot.png" style="width: 600px;" /></a>
</section>
<section id="compare-the-expression-of-specific-genes-over-the-developmental-stages">
<h4>Compare the expression of specific genes over the developmental stages<a class="headerlink" href="#compare-the-expression-of-specific-genes-over-the-developmental-stages" title="Permalink to this heading"></a></h4>
<p>We already have a hypothesis about the expression of some genes over the developmental stages.
Let’s go to the “Visualize” tab to plot the expression of these genes over the developmental stages:</p>
<a class="reference internal image-reference" href="_images/01f01_plot_expression.png"><img alt="Choose genes to plot" src="_images/01f01_plot_expression.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="_images/01f02_plot_expression.png"><img alt="Choose genes to plot - part 2" src="_images/01f02_plot_expression.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="_images/01f03_plot_expression.png"><img alt="Expression plot" src="_images/01f03_plot_expression.png" style="width: 600px;" /></a>
</section>
</section>
<section id="clustering-analysis">
<h3>Clustering analysis<a class="headerlink" href="#clustering-analysis" title="Permalink to this heading"></a></h3>
<p>We are interested in how different groups of genes change in expression level over the life cycle of the worm. We can use clustering analysis to group the genes in this dataset by their expression pattern over the developmental stages.
There is an abundance of approaches when it comes to clustering analysis of gene expression. To illustrate this point, we will cluster our data using three different types of clustering algorithms, arranged from the simplest to the most complex.</p>
<section id="the-simple-approach-distance-based-clustering-with-k-medoids">
<h4>The simple approach - distance-based clustering with K-Medoids<a class="headerlink" href="#the-simple-approach-distance-based-clustering-with-k-medoids" title="Permalink to this heading"></a></h4>
<p>K-Medoids clustering is a distance-based clustering method, where the algorithm attempts to divide all of our genes into K clusters (K is the number of clusters we are looking for), with each cluster being centered around one gene (Medoid).
K-Medoids clustering takes in two major parameters - the number of clusters we expect (K), and the distance metric by which we want to measure the similarity of expression between genes.</p>
<p>Specifying the exact number of clusters we expect is a bit challenging for us, since we aren’t actually sure how many biologically-meaningful clusters are there in our data.
Moreover, this number could depend on how fine-grained we want our analysis to be - we could reasonably divide our genes into a small number of more generalized clusters (such as “genes expressed more in the start of development” vs “genes expressed more near the end of development”), or we could further divide our genes into smaller groups based on their exact temporal expression pattern.</p>
<p>Fortunately, some methods were developed to suggest a good number of clusters for our dataset (a “good number of clusters” meaning that the genes in each clusters are most similar to each other and most different than genes in other clusters). Two of these methods, known as the Silhouette Method and the Gap Statistic, are available in <em>RNAlysis</em>.
We will use the Gap Statistic method to determine some good options for the number of clusters in our analysis.</p>
<p>To start, let’s click on the Clustering tab and choose K-Medoids clustering from the drop-down menu.
We can then set the value of the parameter <cite>n_clusters</cite> to ‘gap’, to indicate we want to use the Gap Statistic to determine the number of clusters in this analysis:</p>
<a class="reference internal image-reference" href="_images/01g01_kmedoids.png"><img alt="K-Medoids clustering setup - choose the number of clusters using the Gap Statistic" src="_images/01g01_kmedoids.png" style="width: 600px;" /></a>
<p>Next, we can set the distance metric. Different distance metrics can be more or less effective on specific types of data.
We will use a distance metric called YR1, that was developed especially for time-series gene expression data. You can read more about it in <a class="reference external" href="https://doi.org/10.1016/j.patrec.2007.09.015">Son and Baek 2007</a>:</p>
<a class="reference internal image-reference" href="_images/01g02_kmedoids.png"><img alt="K-Medoids clustering setup - choose the distance metric" src="_images/01g02_kmedoids.png" style="width: 600px;" /></a>
<p>We can now scroll all the way down, click the “Apply” button, and wait for the analysis to finish:</p>
<a class="reference internal image-reference" href="_images/01g03_kmedoids.png"><img alt="K-Medoids clustering - loading screen" src="_images/01g03_kmedoids.png" style="width: 600px;" /></a>
<p>One the clustering anslysis is finished, a few figures will open up. Let’s examine them one by one.
The first figure will show us the results of the Gap Statistic algorithm. The graph on the left will show us, for each value of <cite>n_clusters</cite> tested, the natural logarithm (ln) of within-cluster dispersion.
We expect this value to go down the more clusters there are (the more clusters there are, the fewer genes will be in each cluster - therefore the genes within each cluster will be more similar to each other), and therefore we show both the actual dispersion values for the clustering solutions we calculated (the blue line), and also dispersion values for clustering solutions on random data, drawn from the same distribution (the orange line).
On the graph to the right we can see the natural logarithm of the ratio between the observed and expected dispersion - this is the Gap Statistic.
We are looking for local ‘peaks’ in the graph -  values of <cite>n_clusters</cite> that have a larger Gap Statistic than their neighbors.
<em>RNAlysis</em> automatically picks the lowest value of <cite>n_clusters</cite> that fits this criterion, but also suggests other good values based on the results.</p>
<a class="reference internal image-reference" href="_images/01g04_kmedoids.png"><img alt="Gap Statistic results" src="_images/01g04_kmedoids.png" style="width: 600px;" /></a>
<p>In our case, <em>RNAlysis</em> recommended 3 clusters as the optimal number of clusters. This value might not be granular enough for the kind of analysis we want to run. Therefore, we will re-run the K-Medoids algorithm with the same parameters, but set the value of <cite>n_clusters</cite> to one of the next good values discovered in the Gap Statistic analysis - 11 clusters.</p>
<p>Next, we can look at the rest of the output of the K-Medoids clustering algorithm for <a href="#id2"><span class="problematic" id="id3">`</span></a>n_clusters`=11.
The first graph will show us the distributions of gene expression in each discovered cluster. Note that the expression values are regularized and power-transformed, since we are interested in grouping the different genes by their relative pattern of expression, and not by their absolute expression levels (highly/lowly-expressed genes).
The clusters are sorted by their size, from the biggest to the smallest cluster.
This type of graph can help us see the general expression pattern that characterizes each cluster. Moreover, it can help point out how internally similar our clusters are - indicating the quality of our clustering result.</p>
<a class="reference internal image-reference" href="_images/01g05_kmedoids.png"><img alt="K-Medoids clustering results" src="_images/01g05_kmedoids.png" style="width: 600px;" /></a>
<p>In this case, we can see that while some clusters seem very internally consistent, quite a few clusters seem to contain a significant number of ‘outlier’ genes.</p>
<p><em>RNAlysis</em> also generates a Principal Component Analysis graph of our gene expression data, marking the genes in each cluster with a different color.
This is another useful way to look at our clustering results - we would hope to see that the first two principal components explain a large degree of the variance in gene expression, and the genes in the same clusters will be grouped together in the graph.</p>
<a class="reference internal image-reference" href="_images/01g06_kmedoids.png"><img alt="K-Medoids clustering results - principal component analysis" src="_images/01g06_kmedoids.png" style="width: 600px;" /></a>
<p>Finally, the following window will open, prompting us to choose which output clusters we want to keep, and giving us the option to give these clusters a new name:</p>
<a class="reference internal image-reference" href="_images/01g07_kmedoids.png"><img alt="K-Medoids clustering results - choose which clusters to keep" src="_images/01g07_kmedoids.png" style="width: 600px;" /></a>
<p>For now, we will choose to keep none of the clusters, so that we can try out other clustering approaches. Therefore, we click either OK or Cancel without selecting any clusters.</p>
</section>
<section id="fine-tuning-our-approach-density-based-clustering-with-hdbscan">
<h4>Fine-tuning our approach - density-based clustering with HDBSCAN<a class="headerlink" href="#fine-tuning-our-approach-density-based-clustering-with-hdbscan" title="Permalink to this heading"></a></h4>
<p>The next clustering approach we will use, HDBSCAN, belongs to a different category of clustering algorithms - density-based clustering.
HDBSCAN stands for Hierarchical Density-Based Spatial Clustering of Applications with Noise (see ` the publication &lt;<a class="reference external" href="https://link.springer.com/chapter/10.1007/978-3-642-37456-2_14">https://link.springer.com/chapter/10.1007/978-3-642-37456-2_14</a>&gt;`_ for more details).
HDBSCAN offers multiple advantages over more traditional clustering methods:</p>
<ol class="arabic simple">
<li><p>HSBSCAN makes relatively few assumptions about the data - it assumes that the data contains noise, as well as some real clusters which we hope to discover.</p></li>
<li><p>Unlike most other clustering methods, HDBSCAN does not “force” every gene to belong to a cluster. Instead, it can classify genes as outliers, excluding them from the final clustering solution.</p></li>
<li><p>HDBSCAN does not require you to guess the number of clusters in the data. The main tuning parameter in HDBSCAN is <em>minimum cluster size</em> (<cite>min_cluster_size</cite>), which determines the smallest “interesting” cluster size we expect to find in the data.</p></li>
</ol>
<p>To run HDBSCAN, we need to pick a value for <cite>min_cluster_size</cite>.
Lower values of <cite>min_cluster_size</cite> will return a larger number of small clusters, revealing more fine-grained patterns in our gene expression data.
Higher values of <cite>min_cluster_size</cite> will return a smaller number of large clusters, revealing the most obvious and significant patterns in the data.
For our example, let’s pick a value of 75:</p>
<a class="reference internal image-reference" href="_images/01g11_hdbscan.png"><img alt="HDBSCAN clustering setup" src="_images/01g11_hdbscan.png" style="width: 600px;" /></a>
<p>We will, once again, use YR1 as the distance metric.</p>
<p>If we look at the clustering results, we can see that HDBSCAN ended up generating a much larger number of clusters than the previous method, and they look fairly internally consistent.
.. image:: /tutorial_screenshots/01g12_hdbscan.png</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">width</dt>
<dd class="field-odd"><p>600</p>
</dd>
<dt class="field-even">alt</dt>
<dd class="field-even"><p>HDBSCAN clustering results</p>
</dd>
</dl>
</div></blockquote>
<a class="reference internal image-reference" href="_images/01g13_hdbscan.png"><img alt="HDBSCAN clustering results - principal component analysis" src="_images/01g13_hdbscan.png" style="width: 600px;" /></a>
<p>Let’s now move on to the final clustering approach - ensemble-based clustering.</p>
</section>
<section id="the-complex-approach-ensemble-based-clustering-with-clicom">
<h4>The complex approach - ensemble-based clustering with CLICOM<a class="headerlink" href="#the-complex-approach-ensemble-based-clustering-with-clicom" title="Permalink to this heading"></a></h4>
<p>The last clustering approach we will use, CLICOM, is an emsemble-based clustering algorithm.
CLICOM (see ` the publication &lt;<a class="reference external" href="https://doi.org/10.1016/j.eswa.2011.08.059">https://doi.org/10.1016/j.eswa.2011.08.059</a>&gt;`_ ) incorporates the results of multiple clustering solutions, which can come from different clustering algorithms with differing clustering parameters, and uses these clustering solutions to create a combined “concensus” clustering solution.
CLICOM offers multiple advantages over more traditional clustering methods:</p>
<ol class="arabic simple">
<li><p>The ensemble clustering approach allows you to combine the results of multiple clustering algorithms with multiple tuning parameters, potentially making up for the weaknesses of each individual clustering method, and only taking into account patterns that robustly appear in many clustering solutions.</p></li>
<li><p>CLICOM does not require you to guess the final number of clusters in the data. The main tuning parameter in HDBSCAN is the <em>evidence threshold</em> (<cite>evidence_threshold</cite>).</p></li>
</ol>
<p><em>RNAlysis</em> offers a modified implementation of CLICOM. The modified version of the algorithm can, like the HDBSCAN algorithm, classify genes as outliers, excluding them from the final clustering solution.</p>
<p>This modified version of CLICOM supports a few tuning parameters, in addition to the clustering solutions themselves:</p>
<ul class="simple">
<li><p><cite>evidence_threshold</cite>: how many clustering solutions (fraction between 0-1) have to agree about  two genes being clustered together in order for them to appear together in the final solution? A lower evidence threshold leads to fewer, large clusters, with fewer features being classified as outliers.</p></li>
<li><p><cite>cluster_unclustered_features</cite>: if True, CLICOM will force every gene to belong to a discovered cluster. Otherwise, genes can be classified as noise and remain unclustered.</p></li>
<li><p><cite>min_cluster_size</cite>: determines the minimal size of a cluster you would consider meaningful. Clusters smaller than this would be classified as noise and filtered out of the final result, or merged into other clusters (depending on the value of <cite>cluster_unclustered_features</cite>).</p></li>
</ul>
<p>To start the analysis, let’s choose the CLICOM algorithm from the Clustering drop-down menu. A new window will open:</p>
<a class="reference internal image-reference" href="_images/01g21_clicom.png"><img alt="CLICOM clustering setup" src="_images/01g21_clicom.png" style="width: 600px;" /></a>
<p>On the left half of the window we can set the tuning parameters of the CLICOM algorithm. For our example, let’s set the evidence threshold to 0.5, and the minimum cluster size to 75.</p>
<p>On the right half of the window we can add new clustering setups to our run of CLICOM. These clustering setups can be any of the clustering algorithms available in <em>RNAlysis</em>, and we can add as many as we want - including multiple clustering setups using the same algorithm.
To add a setup, pick an algorithm from the drop-down menu, set it’s parameters, and click the “Add Setup” button:</p>
<a class="reference internal image-reference" href="_images/01g22_clicom.png"><img alt="CLICOM clustering - add clustering setups" src="_images/01g22_clicom.png" style="width: 600px;" /></a>
<p>The setups you added will appear under “added setups” on the right, and you can delete a setup from that list if you want:</p>
<a class="reference internal image-reference" href="_images/01g23_clicom.png"><img alt="CLICOM clustering - examine added setups" src="_images/01g23_clicom.png" style="width: 600px;" /></a>
<p>Let’s add the two clustering setups we used earlier, plus a few more:</p>
<a class="reference internal image-reference" href="_images/01g24_clicom.png"><img alt="CLICOM clustering - multiple clustering setups" src="_images/01g24_clicom.png" style="width: 600px;" /></a>
<p>Once we are happy with the clustering solutions and tuning parameters, we can click on the “Start CLICOM” button, and see progress reports in the output box on the main window of <em>RNAlysis</em>.</p>
<a class="reference internal image-reference" href="_images/01g25_clicom.png"><img alt="CLICOM clustering loading screen" src="_images/01g25_clicom.png" style="width: 600px;" /></a>
<p>Let’s look at the final result:</p>
<a class="reference internal image-reference" href="_images/01g26_clicom.png"><img alt="CLICOM clustering results" src="_images/01g26_clicom.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="_images/01g27_clicom.png"><img alt="CLICOM clustering results - principal component analysis" src="_images/01g27_clicom.png" style="width: 600px;" /></a>
<p>Let’s choose a few good-looking clusters to keep, and give them a name that indicates their expression pattern:</p>
<a class="reference internal image-reference" href="_images/01g28_clicom.png"><img alt="The clusters we chose to keep" src="_images/01g28_clicom.png" style="width: 600px;" /></a>
<p>For this tutorial, I chose to keep clusters #1 (“down over development”), #2 (“L4 peak”), and #9 (“Down from L1 to adult”).</p>
</section>
</section>
<section id="enrichment-analysis">
<h3>Enrichment analysis<a class="headerlink" href="#enrichment-analysis" title="Permalink to this heading"></a></h3>
<p>Now that we have extracted a few clusters of interest, we can try to characterize their biological significance using enrichment analysis. We will look at the most commonly-used enrichment analysis - Gene Ontology enrichment.</p>
<section id="running-enrichment-analysis">
<h4>Running enrichment analysis<a class="headerlink" href="#running-enrichment-analysis" title="Permalink to this heading"></a></h4>
<p>To open the Enrichent Analysis window, open the ‘Gene sets’ menu and click “Enrichment Analysis”:</p>
<a class="reference internal image-reference" href="_images/01h01_go_enrichment.png"><img alt="Pick 'Enrichment analysis' from the 'Gene sets' menu" src="_images/01h01_go_enrichment.png" style="width: 600px;" /></a>
<p>For basic enrichment analysis, we first need to choose our <em>enrichment set</em> (the gene set we are interested in - for example, “Down from L1 to adult”, cluster #9 we found earlier), and our background set (the reference genes we will be comparing our enrichment results to - for example, the genes in our original filtered table).
We can choose our sets from the two drop-down menus in the Enrichment window:</p>
<a class="reference internal image-reference" href="_images/01h02_go_enrichment.png"><img alt="Enrichment analysis setup - choose the enrichment and background sets" src="_images/01h02_go_enrichment.png" style="width: 600px;" /></a>
<p>Next, we can choose the dataset we want to draw annotations from. In our case, we will choose Gene Ontology (GO).
After picking the dataset, the window expanded to show us all of the parameters we can modify for our analysis:</p>
<a class="reference internal image-reference" href="_images/01h03_go_enrichment.png"><img alt="Enrichment analysis setup - choose the analysis type, organism, and gene ID type" src="_images/01h03_go_enrichment.png" style="width: 600px;" /></a>
<p>Let’s set the statistical test to ‘hypergeometric’, the organism to ‘Caenorhabditis elegans’ (matching our gene expression data), and the Gene ID Type to “WormBase” (matching the gene ID type of our original data table).</p>
<p>We will leave the rest of the settings on the default values, but keep in mind that you can customize the analysis to a significant degree: using different statistical tests (including a statistical test that doesn’t require a background gene set), using only specific types of GO annotations, propagating the annotations differently, etc’. You can read more about these options in the complete user guide.</p>
<p>Scroll to the bottom of thw window and click on the “run” button to run the analysis:</p>
<a class="reference internal image-reference" href="_images/01h04_go_enrichment.png"><img alt="Enrichment analysis loading screen" src="_images/01h04_go_enrichment.png" style="width: 600px;" /></a>
<p>The enrichment window is going to minimize to allow you to read the log box on the main <em>RNAlysis</em> window, but you can enlarge it back if you want to look at the analysis parameters, or start a new analysis with the same parameters.</p>
<p>Once the analysis is done, we will be able to observe our results in multiple formats.</p>
<p>The first is a tabular format, showing all of the statistically significant GO terms we found (or the all of the tests GO terms, if we set the <cite>return_nonsignificant</cite> parameter to True).
The GO terms will be sorted by specificity, the most specific GO terms appearing at the top of the table.
The table also includes the statistics for each GO term (number of genes in the cluster, number of genes matching the GO term, expected number of genes to match the GO term, log2 fold change, p-value, and adjusted p-value).</p>
<a class="reference internal image-reference" href="_images/01h06_go_enrichment.png"><img alt="Enrichment analysis results - tabular format" src="_images/01h06_go_enrichment.png" style="width: 600px;" /></a>
<p>The second output format is an Ontology Graph, depicting the statistically-significant GO terms in each GO aspect (biological process, cellular component, and molecular function), as well as their ancestors in the ontology graph.
The color of the terms on the graph indicates their log2 fold change, and the depth in the tree indicates the specificity of the term, with more specific GO terms being at the bottom.</p>
<a class="reference internal image-reference" href="_images/01h05_go_enrichment.png"><img alt="Enrichment analysis results - ontology graph" src="_images/01h05_go_enrichment.png" style="width: 800px;" /></a>
<p>The final output format is a bar plot depicting the log2 fold change values, as well as significance, of the 10 most specific GO terms that were found to be statistically significant in our analysis.</p>
<a class="reference internal image-reference" href="_images/01h07_go_enrichment.png"><img alt="Enrichment analysis results - bar plot" src="_images/01h07_go_enrichment.png" style="width: 600px;" /></a>
</section>
</section>
</section>
<section id="analysis-2-differential-expression-data">
<h2>Analysis #2 - differential expression data<a class="headerlink" href="#analysis-2-differential-expression-data" title="Permalink to this heading"></a></h2>
<section id="id4">
<h3>The dataset<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h3>
<p>We will start by analyzing XYZ. This dataset describes…</p>
<p>Let’s start by loading the dataset:</p>
<p>#TODO: PtrSc</p>
</section>
<section id="data-filtering-and-visualization-with-pipelines">
<h3>Data filtering and visualization with Pipelines<a class="headerlink" href="#data-filtering-and-visualization-with-pipelines" title="Permalink to this heading"></a></h3>
<p>#TODO</p>
<section id="apply-the-pipeline-to-our-datasets">
<h4>Apply the Pipeline to our datasets<a class="headerlink" href="#apply-the-pipeline-to-our-datasets" title="Permalink to this heading"></a></h4>
</section>
</section>
<section id="visualizing-and-extracting-gene-set-interesctions">
<h3>Visualizing and extracting gene set interesctions<a class="headerlink" href="#visualizing-and-extracting-gene-set-interesctions" title="Permalink to this heading"></a></h3>
<section id="create-a-venn-diagram">
<h4>Create a Venn diagram<a class="headerlink" href="#create-a-venn-diagram" title="Permalink to this heading"></a></h4>
</section>
<section id="extract-the-subsets-we-are-interested-in">
<h4>Extract the subsets we are interested in<a class="headerlink" href="#extract-the-subsets-we-are-interested-in" title="Permalink to this heading"></a></h4>
</section>
</section>
<section id="id5">
<h3>Enrichment analysis<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h3>
<section id="define-a-background-set">
<h4>Define a background set<a class="headerlink" href="#define-a-background-set" title="Permalink to this heading"></a></h4>
</section>
<section id="define-our-custom-enrichment-attributes">
<h4>Define our custom enrichment attributes<a class="headerlink" href="#define-our-custom-enrichment-attributes" title="Permalink to this heading"></a></h4>
</section>
<section id="id6">
<h4>Running enrichment analysis<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h4>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="user_guide.html" class="btn btn-neutral float-right" title="User guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Guy Teichman.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>